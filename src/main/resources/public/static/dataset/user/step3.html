<div data-ng-cloak="" data-ng-controller="Step3Ctrl" class="step step3">
  <div class="col-sm-12">
    
    <div id="trackerRow" class="row" style="width: 100%;">
      <div class="col-sm-12">
        <div style="margin-left:7px;" id="tracker">
          <div class="row smpl-step">

            <div class="col-xs-3 smpl-step-step {{ step1 }}">
              <div class="progress disabled">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-database" style="font-size: 23px; padding-left: 8px; padding-top: 5px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 1: </span> View  and Select Datasets</small></div>
            </div>

            <div class="col-xs-3 smpl-step-step {{ step2 }}">
              <div class="progress">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-check-square-o" style="font-size: 22px; padding-left: 8px; padding-top: 7px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 2: </span>Select Data Elements</small></div>
            </div>

            <div class="col-xs-3 smpl-step-step {{ step3 }}">
              <div class="progress">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-filter" style="font-size: 22px; padding-left: 9px; padding-top: 5px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 3: </span> Filter Data</small></div>
            </div>

            <div class="col-xs-3 smpl-step-step {{ step4 }}">
              <div class="progress">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-file " style="font-size: 22px; padding-left: 9px; padding-top: 5px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 4: </span> Generate Output</small></div>
            </div>

          </div>
        </div>
        <div class="alert alert-info" role="alert">
          <strong>STEP 3</strong>
          Apply filters to your selected data by choosing relevant attributes in the parameters below.
        </div>
      </div>
    </div>

    <div id="datasetContents" class="row">
      <div class="col-sm-12">
        <h4>
          Filter Data
        </h4>
      </div>
    </div>
    
    <form name="datasetFilterForm" role="form" data-ng-submit="save()">
      <div class="row">
        <div class="col-sm-12">
          <div data-ng-show="loadingFilters === 0" class="well form-horizontal">
            <i class="fa fa-spin fa-spinner"></i>
            Loading Filters...
          </div>
          <div data-ng-show="loadingFilters === 1" class="well form-horizontal">
            <div data-ng-repeat="availableCriterion in availableCriteria" class="form-group">
              <label for="filter{{ availableCriterion.filterId }}" class="col-sm-2 control-label" style="padding-right: 10px;">
                {{ availableCriterion.label }}
              </label>
              <div data-ng-if="availableCriterion.filterId === 16" class="col-sm-4">
                <input type="text" id="filter{{ availableCriterion.filterId }}" autocomplete="off"
                       name="{{ availableCriterion.filterName }}" class="form-control"
                       data-ng-model="selectedValues[availableCriterion.filterId]"
                       typeahead="school.key as school.value for school in searchSchools($viewValue)"
                       typeahead-loading="loadingSchools" typeahead-min-length="3"
                       typeahead-on-select="selectSchool($item)" typeahead-wait-ms="500"/>
                <i data-ng-show="loadingSchools" class="fa fa-spin fa-spinner"></i>
                <small data-ng-show="loadingSchools">Loading list of Schools...</small>
              </div>
              <div data-ng-if="availableCriterion.filterId !== 16" class="col-sm-4">
                <select id="{{ availableCriterion.filterName }}" class="form-control"
                        data-ng-model="selectedValues[availableCriterion.filterId]"
                        data-ng-change="setFilter(availableCriterion)"
                        data-ng-options="option.value for option in availableCriterion.selection">
                </select>
              </div>
            </div>
          </div>
          <div data-ng-show="loadingFilters === 2" class="alert alert-danger">
            {{ loadingFiltersError }}
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-sm-12">
          <div class="alert alert-warning alert-dismissible" role="alert">
            <small>
              Are you done filtering your data? If yes, click the next step button below.
              If you wish to add or remove data element/s, click the previous step button.
            </small>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-sm-12">
          <button type="button" class="btn btn-default" data-ui-sref="step2">
            Previous
          </button>
          <button type="button" class="btn btn-primary" data-ng-click="save()">
            Next
          </button>
        </div>
      </div>
    </form>
    
  </div>
</div>