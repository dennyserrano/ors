<div data-ng-cloak="" data-ng-controller="Step2Ctrl" class="step step2">
  <div class="col-sm-12">
    <div id="trackerRow" class="row" style="width: 100%;">
      <div class="col-sm-12">
        <div style="margin-left:7px;" id="tracker">
          <div class="row smpl-step">

            <div class="col-xs-3 smpl-step-step {{ step1 }}">
              <div class="progress disabled">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-database" style="font-size: 23px; padding-left: 8px; padding-top: 5px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 1: </span> View  and Select Datasets</small></div>
            </div>

            <div class="col-xs-3 smpl-step-step {{ step2 }}">
              <div class="progress">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-check-square-o" style="font-size: 22px; padding-left: 8px; padding-top: 7px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 2: </span>Select Data Elements</small></div>
            </div>

            <div class="col-xs-3 smpl-step-step {{ step3 }}">
              <div class="progress">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-filter" style="font-size: 22px; padding-left: 9px; padding-top: 5px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 3: </span> Filter Data</small></div>
            </div>

            <div class="col-xs-3 smpl-step-step {{ step4 }}">
              <div class="progress">
                <div class="progress-bar"></div>
              </div>
              <a class="smpl-step-icon"><i class="fa fa-file " style="font-size: 22px; padding-left: 9px; padding-top: 5px; color: #fbbd19;"></i></a>
              <div class="smpl-step-info text-center"><small><span style="font-weight:bold; color:#118beb;">Step 4: </span> Generate Output</small></div>
            </div>

          </div>
        </div>
        <div class="alert alert-info" role="alert">
          <strong>STEP 2</strong>
          Select/deselect Data Elements under each Dataset you have chosen.
        </div>
      </div>
    </div>
    
    <div id="datasetContents" class="row">
      <div data-ng-if="loadingElements === 0" class="col-sm-12">
        <i class="fa fa-spin fa-spinner"></i>
        Loading Elements...
      </div>

      <div data-ng-show="loadingElements === 1" class="col-sm-12">
      <input type='checkbox' data-ng-model="aggregateCheckValue"> Aggregate
      
      
      <div id="elements" double-scroll-bar-horizontal="" class="table-responsive" data-ng-if="aggregateCheckValue">
        <div id="tableWrapper" class="table-wrapper">

          <table id="elementsTable" class="table table-bordered table-striped table-condensed"
                 style="font-size: small;" cellpadding="0" cellspacing="0" border="0">
            <thead class="white-bg">
              <tr>
                <th bindonce data-ng-repeat="subdataset in elementsTable.datasets" colspan="3" bo-text="subdataset.name"></th>
              </tr>
              <tr style="background-color: blue; color: #FFF;">
                <th bindonce data-ng-repeat-start="subdataset in elementsTable.datasets" style="padding: 5px;">
                  <input type="checkbox" id="subdataset{{ ::subdataset.id }}"
                         data-ng-checked="allElementsSelected[subdataset.id]"
                         data-ng-click="toggleAllElementsSelection(subdataset.id)"/>
                </th>
                <th>
                  Element Name
                </th>
                <th data-ng-repeat-end="">
                  Definition
                </th>
                <th>
                	Aggregate Function
                </th>
              </tr>
            </thead>
            <tbody>
              <tr bindonce data-ng-repeat="idx in elementsTable.elementsIndex">
                <td bindonce data-ng-repeat-start="subdataset in elementsTable.datasets"
                    data-ng-init="element = elementsTable.elements[idx][subdataset.id]">
                  <input type="checkbox" id="element{{ ::element.id }}" data-ng-if="element"
                         data-ng-model="elementsSelection[subdataset.id][element.id]"/>
                </td>
                <td bo-text="element.name" ></td>
                <td bo-text="element.description" ></td>
                <td data-ng-repeat-end="">
                	
                	
                	<select ng-model="ha" data-ng-options="x for x in ['Sum','Average']" data-ng-init="ha='Sum'" data-ng-hide='!element.aggregatable'>
                	
                	</select>
                </td>
              </tr>
            </tbody>
          </table>
          
        </div>
      </div>
      
      <div id="elements" double-scroll-bar-horizontal="" class="table-responsive" data-ng-if="!aggregateCheckValue">
        <div id="tableWrapper" class="table-wrapper">

          <table id="elementsTable" class="table table-bordered table-striped table-condensed"
                 style="font-size: small;" cellpadding="0" cellspacing="0" border="0">
            <thead class="white-bg">
              <tr>
                <th bindonce data-ng-repeat="subdataset in elementsTable.datasets" colspan="3" bo-text="subdataset.name"></th>
              </tr>
              <tr style="background-color: blue; color: #FFF;">
                <th bindonce data-ng-repeat-start="subdataset in elementsTable.datasets" style="padding: 5px;">
                  <input type="checkbox" id="subdataset{{ ::subdataset.id }}"
                         data-ng-checked="allElementsSelected[subdataset.id]"
                         data-ng-click="toggleAllElementsSelection(subdataset.id)"/>
                </th>
                <th>
                  Element Name
                </th>
                <th data-ng-repeat-end="">
                  Definition
                </th>
              </tr>
            </thead>
            <tbody>
              <tr bindonce data-ng-repeat="idx in elementsTable.elementsIndex">
                <td bindonce data-ng-repeat-start="subdataset in elementsTable.datasets"
                    data-ng-init="element = elementsTable.elements[idx][subdataset.id]">
                  <input type="checkbox" id="element{{ ::element.id }}" data-ng-if="element"
                         data-ng-model="elementsSelection[subdataset.id][element.id]"/>
                </td>
                <td bo-text="element.name" ></td>
                <td bo-text="element.description" data-ng-repeat-end=""></td>
              </tr>
            </tbody>
          </table>
          
        </div>
      </div>
      
      
      </div>

      <div data-ng-if="loadingElements === 2" class="col-sm-12">
        <div class="alert alert-danger">
          {{ ::loadingElementsError }}
        </div>
      </div>
    </div>
    
    <div data-ng-if="loadingElements === 1" class="row">
      <div class="col-sm 12">
        <div class="alert alert-warning alert-dismissible" role="alert">
          <small>
            Are you done selecting data elements? If yes, click the next step button below.
            If you wish to add or remove a dataset, click the previous step button.
          </small>
        </div>
      </div>
    </div>
    
    <div data-ng-if="loadingElements === 1" class="row">
      <div class="col-sm-12">
        <button type="button" class="btn btn-default" data-ng-click="previous()">
          Previous
        </button>
        <button id="nextBtn" data-ng-disabled="saving" type="button" class="btn btn-primary" data-ng-click="save()">
          Next
        </button>
        <i data-ng-show="saving" class="fa fa-spin fa-spinner"></i>
      </div>
    </div>
  </div>
</div>