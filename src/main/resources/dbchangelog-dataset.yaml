databaseChangeLog:
  - preConditions:
      - dbms:
          type: mysql
  - changeSet:
      id: ds-201408191255
      author: ej
      changes:
        - createTable:
            tableName: dataset_head
            columns:
              - column:
                  name: id
                  type: bigint
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: varchar(100)
                  constraints:

                    nullable: false
              - column:
                  name: description
                  type: varchar(1000)
              - column:
                  name: owner_id
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: date_created
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: date_updated
                  type: timestamp
              - column:
                  name: updated_by
                  type: varchar(50)
        - addUniqueConstraint:
            tableName: dataset_head
            columnNames: name
            constraintName: dataset_head_name_unique
        - rollback:
            - dropTable:
                tableName: dataset_head
  - changeSet:
      id: ds-201408191304
      author: ej
      changes:
        - createTable:
            tableName: dataset_table
            columns:
              - column:
                  name: id
                  type: bigint
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: dataset_head_id
                  type: bigint
                  constraints:
                    nullable: false
              - column:
                  name: table_id
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: prefix
                  type: varchar(10)
              - column:
                  name: derived_from
                  type: bigint
              - column:
                  name: date_created
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: date_updated
                  type: timestamp
              - column:
                  name: updated_by
                  type: varchar(50)
        - addForeignKeyConstraint:
            constraintName: dataset_head_table_fk
            baseTableName: dataset_table
            baseColumnNames: dataset_head_id
            referencedTableName: dataset_head
            referencedColumnNames: id
        - rollback:
            - dropTable:
                tableName: dataset_table
  - changeSet:
      id: ds-201408191307
      author: ej
      changes:
        - createTable:
            tableName: dataset_element
            columns:
              - column:
                  name: id
                  type: bigint
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: dataset_table_id
                  type: bigint
                  constraints:
                    nullable: false
              - column:
                  name: column_id
                  type: int
              - column:
                  name: alias
                  type: varchar(100)
              - column:
                  name: function
                  type: varchar(100)
              - column:
                  name: date_created
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: date_updated
                  type: timestamp
              - column:
                  name: updated_by
                  type: varchar(50)
        - addForeignKeyConstraint:
            constraintName: dataset_table_element_fk
            baseTableName: dataset_element
            baseColumnNames: dataset_table_id
            referencedTableName: dataset_table
            referencedColumnNames: id
        - rollback:
            - dropTable:
                tableName: dataset_element
  - changeSet:
      id: ds-201408191328
      author: ej
      changes:
        - createTable:
            tableName: dataset_criteria
            columns:
              - column:
                  name: id
                  type: bigint
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: dataset_head_id
                  type: bigint
                  constraints:
                    nullable: false
              - column:
                  name: filter_type
                  type: smallint
                  constraints:
                    nullable: false
              - column:
                  name: left_element_id
                  type: bigint
                  constraints:
                    nullable: false
              - column:
                  name: operator
                  type: varchar(10)
                  constraints:
                    nullable: false
              - column:
                  name: right_value
                  type: varchar(1000)
              - column:
                  name: value_type
                  type: int
              - column:
                  name: right_element_id
                  type: bigint
              - column:
                  name: date_created
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: date_updated
                  type: timestamp
              - column:
                  name: updated_by
                  type: varchar(50)
        - addForeignKeyConstraint:
            constraintName: dataset_head_criteria_fk
            baseTableName: dataset_criteria
            baseColumnNames: dataset_head_id
            referencedTableName: dataset_head
            referencedColumnNames: id
        - addForeignKeyConstraint:
            constraintName: dataset_left_element_fk
            baseTableName: dataset_criteria
            baseColumnNames: left_element_id
            referencedTableName: dataset_element
            referencedColumnNames: id
        - addForeignKeyConstraint:
            constraintName: dataset_right_element_fk
            baseTableName: dataset_criteria
            baseColumnNames: right_element_id
            referencedTableName: dataset_element
            referencedColumnNames: id
        - rollback:
            - dropTable:
                tableName: dataset_criteria
  - changeSet:
      id: ds-201408191355
      author: ej
      changes:
        - createTable:
            tableName: dataset_filter_combination
            columns:
              - column:
                  name: id
                  type: bigint
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: dataset_head_id
                  type: bigint
                  constraints:
                    nullable: false
              - column:
                  name: left_filter_id
                  type: bigint
              - column:
                  name: left_combination_id
                  type: bigint
              - column:
                  name: operator
                  type: varchar(10)
                  constraints:
                    nullable: false
              - column:
                  name: right_filter_id
                  type: bigint
              - column:
                  name: right_combination_id
                  type: bigint
              - column:
                  name: date_created
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: created_by
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: date_updated
                  type: timestamp
              - column:
                  name: updated_by
                  type: varchar(50)
        - addForeignKeyConstraint:
            constraintName: dataset_head_filter_combination_fk
            baseTableName: dataset_filter_combination
            baseColumnNames: dataset_head_id
            referencedTableName: dataset_head
            referencedColumnNames: id
        - addForeignKeyConstraint:
            constraintName: dataset_left_criteria_fk
            baseTableName: dataset_filter_combination
            baseColumnNames: left_filter_id
            referencedTableName: dataset_criteria
            referencedColumnNames: id
        - addForeignKeyConstraint:
            constraintName: dataset_right_criteria_fk
            baseTableName: dataset_filter_combination
            baseColumnNames: right_filter_id
            referencedTableName: dataset_criteria
            referencedColumnNames: id
        - rollback:
            - dropTable:
                tableName: dataset_filter_combination
  - changeSet:
      id: ds-201408221529
      author: ej
      changes:
        - addColumn:
            tableName: dataset_element
            columns:
              - column:
                  name: name
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: meaning
                  type: varchar(1000)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: varchar(500)
  - changeSet:
      id: ds-201409051008
      author: ej
      changes:
        - renameTable:
            oldTableName: dataset_filter_combination
            newTableName: dataset_filter_chain
  - changeSet:
      id: ds-201409051020
      author: ej
      changes:
        - dropColumn:
            tableName: dataset_filter_chain
            columnName: right_combination_id
        - renameColumn:
            tableName: dataset_filter_chain
            oldColumnName: left_combination_id
            newColumnName: parent_filter_chain
            columnDataType: bigint