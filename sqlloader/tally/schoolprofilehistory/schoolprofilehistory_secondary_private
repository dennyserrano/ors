SELECT COUNT(* )
  
FROM ebeisdb.school_profile_history sph
INNER JOIN ebeisdb.ref_region
  ON (sph.REGION_ID = ref_region.ID)
LEFT JOIN ebeisdb.ref_municipality
  ON (sph.REF_MUNICIPALITY_ID = ref_municipality.ID)
LEFT JOIN ebeisdb.ref_province
  ON (ref_municipality.REF_PROVINCE_ID = ref_province.ID)
LEFT JOIN ebeisdb.ref_office ref_d
  ON (sph.DIVISION_ID = ref_d.ID)
LEFT JOIN ebeisdb.ref_office ref_dis
  ON (sph.DISTRICT_ID = ref_dis.ID)
LEFT JOIN ebeisdb.ref_legislative
  ON (sph.REF_LEGISLATIVE_ID = ref_legislative.ID)
LEFT JOIN ebeisdb.ref_code_setting rld
  ON (ref_legislative.DISTRICT_LABEL = rld.ID)
LEFT JOIN ebeisdb.ref_baranggay
  ON (sph.branggay_id = ref_baranggay.id)
LEFT JOIN ebeisdb.ref_municipality rlm
  ON (ref_legislative.REF_MUNICIPALITY_ID = rlm.ID)
LEFT JOIN ebeisdb.ref_province rlp
  ON (ref_legislative.REF_PROVINCE_ID = rlp.ID)
LEFT JOIN ebeisdb.ref_code_setting st
  ON (sph.SCHOOL_TYPE_ID = st.ID)
LEFT JOIN ebeisdb.ref_code_setting genc
  ON (sph.CO_GEN_CLASS = genc.ID)
LEFT JOIN ebeisdb.ref_code_setting sect
  ON (sph.general_classification_id = sect.id)
LEFT JOIN ebeisdb.ref_code_setting subc
  ON (sph.SCHOOL_SUBCLASSIFICATION_ID = subc.ID)
LEFT JOIN ebeisdb.ref_code_setting curr
  ON (sph.CURRICULAR_CLASS_ID = curr.ID)
LEFT JOIN ebeisdb.ref_code_setting corg
  ON (sph.CLASS_ORGANIZATION_ID = corg.ID)
LEFT JOIN ebeisdb.ref_income_class inc
  ON (ref_municipality.INCOMECLASS = inc.ID)
LEFT JOIN ebeisdb.school_profile_history sph2
  ON (sph2.school_id = sph.mother_school_id and sph2.sy_from = sph.sy_from)
LEFT JOIN ebeisdb.ref_code_setting cosc
  ON (sph.curricular_subclass_id = cosc.id)
LEFT JOIN ebeisdb.ref_code_setting ec
  ON (sph.elementary_class_id = ec.id)
LEFT JOIN ebeisdb.ref_code_setting ssown
  ON (sph.site_ownership_id = ssown.id)
LEFT JOIN ebeisdb.ref_code_setting ssproof
  ON (sph.proof_of_ownership_id = ssproof.id)
LEFT JOIN ebeisdb.ref_code_setting ownissue
  ON (sph.ownership_issue_id = ownissue.id)
LEFT JOIN ebeisdb.ref_code_setting tp
  ON (sph.topography_id = tp.id)
where 
sph.sy_from=2016 and 
sph.co_gen_class=434 and 
sph.general_classification_id=8 and 
sph.take_part_id=1 and
sph.school_subclassification_id not in (713) and 
sph.curricular_class_id not in (921) and
sph.date_closed is NULL
ORDER BY sph.sy_from, ref_region.rank, sph.school_id;
